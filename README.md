# bigcommerce/test-injector 

Auto-mocking test Dependency Injector component

Will automatically mock all injected dependencies of an object using the BigCommerce Injector. This allows objects to be
refactored to have dependencies removed or new ones added without needing to rebuild all the mock definitions or modify
many tests, making decoupled DI driven development much easier.

Mocks can be configured with expectations by calling getMock(CLASS_NAME) on the TestInjector within your tests. This 
will return an ObjectProphecy object (a mock generated by Prophecy - the mocking library included in PHPUnit).

A single mock instance is created per Fully Qualified Class Name, so if the object you're testing takes two of the same
typed parameter, the same mock will be passed to both (so ensure your expectations are set appropriately).

Construction Usage:
````
// All constructor dependencies resolved through mocking
$testObject = $testInjector->create(My\Test\Object::class); 

// Parameter injection - will provide parameters either by type, name or position - otherwise resolve via mocking
$testObject = $testInjector->create(My\Test\Object::class, [
    "enabled" => true,              // Named
    7 => "fish",                    // Positional
    Logger::class => new Logger(),  // Type
]);
````

Invocation usage
````
// Call the method 'createUser' on an existing object
$testObject = $testInjector->invoke($instanceOfThing, "createUser");

// Parameter injection - will provide parameters either by type, name or position - otherwise resolve via mocking
$testObject = $testInjector->invoke($instanceOfThing, "createUser", [
    "enabled" => true,              // Named
    7 => "fish",                    // Positional
    Logger::class => new Logger(),  // Type
]);
````


For integration with your PHPUnit tests, see: [AutoMockingTest.php](src/AutoMockingTest.php) 